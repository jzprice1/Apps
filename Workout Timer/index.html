<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workout + Timer</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    height: 100vh;
    overflow: hidden;
  }

  /* TOP BAR */
  #topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    font-size: 2rem;
    border-bottom: 1px solid #333;
  }

  #topbar button {
    background: none;
    border: none;
    color: white;
    font-size: 2rem;
    cursor: pointer;
  }

  /* TIMER */
  #timer-container {
    position: sticky; 
    top: 0;
    z-index: 10; 
    text-align: center;
    padding: 12px 0;
    border-bottom: 1px solid #333;
  }

  #timer {
    font-size: 4rem;
  }

  #timer-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin: 10px 0;
  }

  #timer-buttons button {
    flex: 1;
    padding: 10px;
    font-size: 1.1rem;
    background: #222;
    color: white;
    border: 1px solid #444;
    border-radius: 8px;
  }

  #timer-buttons button:active {
    background: #333;
  }

  /* WORKOUT TRACKER */
  #tracker-screen {
    height: calc(100vh - 70px);
    overflow-y: auto;
    padding: 20px;
  }

  #tracker-screen h2 {
    text-align: center;
    font-size: 2rem;
    font-weight: 600;
    margin-top: 0;
  }

  .exercise-row {
    margin-bottom: 20px;
  }

  input[type="text"] {
    width: 100%;
    padding: 10px;
    font-size: 1.1rem;
    background: #222;
    color: #eee;
    border: 1px solid #444;
    border-radius: 6px;
  }

  .sets-label {
    margin-top: 8px;
    font-size: 1rem;
    opacity: 0.8;
  }

  .checkboxes {
    display: flex;
    gap: 12px;
    margin-top: 10px;
  }

  input[type="checkbox"] {
    width: 22px;
    height: 22px;
  }

  button.action {
    margin-top: 20px;
    padding: 12px;
    width: 100%;
    font-size: 1.2rem;
    background: #333;
    color: #eee;
    border: 1px solid #555;
    border-radius: 6px;
  }

  #summary {
    white-space: pre-wrap;
    margin-top: 10px;
    padding: 12px;
    border: 1px solid #444;
    background: #1a1a1a;
    font-family: monospace;
    border-radius: 6px;
  }

  /* HISTORY SCREEN */
  #history-screen {
    display: none;
    height: calc(100vh - 70px);
    overflow-y: auto;
    padding: 20px;
  }

  .history-entry {
    border: 1px solid #444;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 16px;
    background: #1a1a1a;
  }

  .history-entry h3 {
    margin: 0 0 8px 0;
    font-size: 1.2rem;
  }

  #history-summary {
    margin-top: 20px;
    padding: 12px;
    background: #111;
    border: 1px solid #444;
    border-radius: 6px;
    white-space: pre-wrap;
    font-family: monospace;
  }

  /* TOAST */
  #toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #0f0;
    color: #000;
    padding: 10px 20px;
    border-radius: 6px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
  }

  #toast.show {
    opacity: 1;
  }
</style>
</head>
<body>

<!-- TOP BAR -->
<div id="topbar">
  <button id="open-history">üìÖ</button>
  <span id="clock-text"></span>
  <button id="open-tracker">‚è±Ô∏è</button>
</div>

<!-- TRACKER SCREEN -->
<div id="tracker-screen">
  <div id="timer-container">
    <div id="timer">2:00</div>
  </div>

  <div id="timer-buttons">
    <button id="reset">Reset Timer</button>
    <button id="edit-timer">‚úèÔ∏è Edit</button>
  </div>

  <h2>Workout Tracker</h2>

  <div id="exerciseContainer"></div>

  <button id="doneBtn" class="action">Done</button>
  <button id="copyBtn" class="action">Copy Summary</button>

  <div id="summary"></div>
</div>

<!-- HISTORY SCREEN -->
<div id="history-screen">
  <div id="history-list"></div>
  <button id="history-summary-btn" class="action">Summary</button>
  <button id="history-copy-btn" class="action">Copy Summary</button>
<div id="history-summary"></div>

</div>

<!-- TOAST -->
<div id="toast">Copied!</div>

<script>
/* CLOCK */
const clock = document.getElementById("clock-text");
function updateClock() {
  const now = new Date();
  clock.textContent = now.toLocaleTimeString([], {
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit"
  });
}
updateClock();
setInterval(updateClock, 1000);

/* TIMER */
let TIMER_DURATION = 120000;
const STORAGE_KEY = "accurate_timer_start";
const LENGTH_KEY = "timer_length_minutes";

const timerDisplay = document.getElementById("timer");
const resetButton = document.getElementById("reset");
const editButton = document.getElementById("edit-timer");

let interval;

function getRemainingTime() {
  const startTime = parseInt(localStorage.getItem(STORAGE_KEY), 10);
  if (!startTime) return 0;
  const elapsed = Date.now() - startTime;
  return Math.max(0, TIMER_DURATION - elapsed);
}

function renderTimer() {
  const remainingMs = getRemainingTime();
  const totalSeconds = Math.ceil(remainingMs / 1000);
  const minutes = Math.floor(totalSeconds / 60);
  const seconds = totalSeconds % 60;
  timerDisplay.textContent = minutes + ":" + String(seconds).padStart(2, "0");

  if (remainingMs <= 0) {
    clearInterval(interval);
    timerDisplay.textContent = "0:00";
  }
}

function startTimer() {
  clearInterval(interval);
  localStorage.setItem(STORAGE_KEY, Date.now());
  renderTimer();
  interval = setInterval(renderTimer, 1000);
}

resetButton.addEventListener("click", startTimer);

editButton.addEventListener("click", () => {
  const newMinutes = parseFloat(prompt("Enter new timer length (minutes):"));
  if (!isNaN(newMinutes) && newMinutes > 0) {
    TIMER_DURATION = newMinutes * 60000;
    localStorage.setItem(LENGTH_KEY, newMinutes);
    startTimer();
  }
});

const savedLength = parseFloat(localStorage.getItem(LENGTH_KEY));
if (!isNaN(savedLength) && savedLength > 0) {
  TIMER_DURATION = savedLength * 60000;
}

if (!localStorage.getItem(STORAGE_KEY)) {
  startTimer();
} else {
  renderTimer();
  interval = setInterval(renderTimer, 1000);
}

/* WORKOUT TRACKER */
const container = document.getElementById("exerciseContainer");

function createCheckboxRow() {
  const wrapper = document.createElement("div");
  wrapper.className = "checkboxes";

  const first = document.createElement("input");
  first.type = "checkbox";
  wrapper.appendChild(first);

  wrapper.addEventListener("change", () => {
    const boxes = wrapper.querySelectorAll("input[type='checkbox']");
    const last = boxes[boxes.length - 1];
    if (last.checked) {
      const newBox = document.createElement("input");
      newBox.type = "checkbox";
      wrapper.appendChild(newBox);
    }
  });

  return wrapper;
}

function createExerciseRow() {
  const row = document.createElement("div");
  row.className = "exercise-row";

  const input = document.createElement("input");
  input.type = "text";
  input.placeholder = "Exercise name...";

  const setsLabel = document.createElement("div");
  setsLabel.className = "sets-label";
  setsLabel.textContent = "Sets:";

  const checkboxWrapper = createCheckboxRow();

  input.addEventListener("input", () => {
    const rows = document.querySelectorAll(".exercise-row input[type='text']");
    if (input === rows[rows.length - 1] && input.value.trim() !== "") {
      createExerciseRow();
    }
  });

  row.appendChild(input);
  row.appendChild(setsLabel);
  row.appendChild(checkboxWrapper);
  container.appendChild(row);
}

createExerciseRow();

/* SAVE WORKOUT HISTORY */
document.getElementById("doneBtn").addEventListener("click", () => {
  const rows = document.querySelectorAll(".exercise-row");
  let summaryText = "";
  const workout = {
    timestamp: Date.now(),
    exercises: []
  };

  rows.forEach(row => {
    const input = row.querySelector("input[type='text']");
    const checkboxes = row.querySelectorAll("input[type='checkbox']");
    const name = input.value.trim();

    if (name !== "") {
      let count = 0;
      checkboxes.forEach(cb => { if (cb.checked) count++; });

      workout.exercises.push({ name, sets: count });
      summaryText += `Exercise: ${name}\nSets: ${count}\n\n`;
    }
  });

  document.getElementById("summary").textContent = summaryText.trim();

  let history = JSON.parse(localStorage.getItem("workout_history") || "[]");
  history.push(workout);
  localStorage.setItem("workout_history", JSON.stringify(history));
});

/* COPY POPUP */
document.getElementById("copyBtn").addEventListener("click", () => {
  const text = document.getElementById("summary").textContent;
  navigator.clipboard.writeText(text);

  const toast = document.getElementById("toast");
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 1000);
});

/* NAVIGATION */
const trackerScreen = document.getElementById("tracker-screen");
const historyScreen = document.getElementById("history-screen");
const historyList = document.getElementById("history-list");

document.getElementById("open-history").addEventListener("click", () => {
  trackerScreen.style.display = "none";
  historyScreen.style.display = "block";
  loadHistory();
});

document.getElementById("open-tracker").addEventListener("click", () => {
  historyScreen.style.display = "none";
  trackerScreen.style.display = "block";
});

/* RENDER HISTORY */
function loadHistory() {
  const history = JSON.parse(localStorage.getItem("workout_history") || "[]");
  historyList.innerHTML = "";

  history.forEach(entry => {
    const div = document.createElement("div");
    div.className = "history-entry";

    const date = new Date(entry.timestamp).toLocaleString();

    let html = `<h3>${date}</h3>`;
    entry.exercises.forEach(ex => {
      html += `<div>${ex.name} ‚Äî ${ex.sets} sets</div>`;
    });

    div.innerHTML = html;
    historyList.appendChild(div);
  });
}

/* HISTORY SUMMARY ‚Äî COUNT SETS PER EXERCISE TYPE */
document.getElementById("history-summary-btn").addEventListener("click", () => {
  const history = JSON.parse(localStorage.getItem("workout_history") || "[]");

  // Build a dictionary of exercise ‚Üí total sets
  const totals = {};

  history.forEach(workout => {
    workout.exercises.forEach(ex => {
      const name = ex.name.trim();
      if (!totals[name]) totals[name] = 0;
      totals[name] += ex.sets;
    });
  });

  // Build summary text
  let summary = "";
  Object.keys(totals).forEach(name => {
    summary += `${name} ‚Äî ${totals[name]} sets\n`;
  });

  document.getElementById("history-summary").textContent = summary.trim();
});


</script>

</body>
</html>
