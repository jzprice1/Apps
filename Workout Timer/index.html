<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workout + Timer</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  /* CLOCK + TIMER */
  #clock {
    text-align: center;
    padding: 16px 0;
    font-size: 2rem;
    border-bottom: 1px solid #333;
    position: relative;
  }

  #edit-timer {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: white;
    font-size: 1.4rem;
    cursor: pointer;
  }

  #timer-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 12px 0;
  }

  #timer {
    font-size: 4rem;
    text-align: center;
  }

  #reset {
    background: black;
    color: white;
    border: 1px solid white;
    padding: 10px;
    font-size: 1.1rem;
    margin: 10px auto;
    border-radius: 8px;
    width: 90%;
  }

  #reset:active {
    background: #222;
  }

  /* WORKOUT TRACKER */
  #content {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
  }

  #content h2 {
    text-align: center;
    font-size: 2rem;
    font-weight: 600;
    margin-top: 0;
  }

  .exercise-row {
    margin-bottom: 20px;
  }

  input[type="text"] {
    width: 100%;
    padding: 10px;
    font-size: 1.1rem;
    background: #222;
    color: #eee;
    border: 1px solid #444;
    border-radius: 6px;
  }

  .sets-label {
    margin-top: 8px;
    font-size: 1rem;
    opacity: 0.8;
  }

  .checkboxes {
    display: flex;
    gap: 12px;
    margin-top: 10px;
  }

  input[type="checkbox"] {
    width: 22px;
    height: 22px;
  }

  button.action {
    margin-top: 20px;
    padding: 12px;
    width: 100%;
    font-size: 1.2rem;
    background: #333;
    color: #eee;
    border: 1px solid #555;
    border-radius: 6px;
  }

  #summary {
    white-space: pre-wrap;
    margin-top: 10px;
    padding: 12px;
    border: 1px solid #444;
    background: #1a1a1a;
    font-family: monospace;
    border-radius: 6px;
  }

  /* TOAST POPUP */
  #toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #0f0;
    color: #000;
    padding: 10px 20px;
    border-radius: 6px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
  }

  #toast.show {
    opacity: 1;
  }
</style>
</head>
<body>

<!-- CLOCK -->
<div id="clock">
  <span id="clock-text"></span>
  <button id="edit-timer" title="Change timer length">✏️</button>
</div>

<!-- TIMER -->
<div id="timer-container">
  <div id="timer">2:00</div>
</div>

<button id="reset">Reset Timer</button>

<!-- WORKOUT TRACKER -->
<div id="content">
  <h2>Workout Tracker</h2>
  <div id="exerciseContainer"></div>

  <button id="doneBtn" class="action">Done</button>
  <button id="copyBtn" class="action">Copy Summary</button>

  <div id="summary"></div>
</div>

<!-- TOAST -->
<div id="toast">Copied!</div>

<script>
  /* ---------------- CLOCK ---------------- */
  const clock = document.getElementById("clock-text");
  function updateClock() {
    const now = new Date();
    clock.textContent = now.toLocaleTimeString([], {
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    });
  }
  updateClock();
  setInterval(updateClock, 1000);

  /* ---------------- TIMER ---------------- */
  let TIMER_DURATION = 120000;
  const STORAGE_KEY = "accurate_timer_start";
  const LENGTH_KEY = "timer_length_minutes";

  const timerDisplay = document.getElementById("timer");
  const resetButton = document.getElementById("reset");
  const editButton = document.getElementById("edit-timer");

  let interval;

  function getRemainingTime() {
    const startTime = parseInt(localStorage.getItem(STORAGE_KEY), 10);
    if (!startTime) return 0;
    const elapsed = Date.now() - startTime;
    return Math.max(0, TIMER_DURATION - elapsed);
  }

  function renderTimer() {
    const remainingMs = getRemainingTime();
    const totalSeconds = Math.ceil(remainingMs / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    timerDisplay.textContent = minutes + ":" + String(seconds).padStart(2, "0");

    if (remainingMs <= 0) {
      clearInterval(interval);
      timerDisplay.textContent = "0:00";
    }
  }

  function startTimer() {
    clearInterval(interval);
    localStorage.setItem(STORAGE_KEY, Date.now());
    renderTimer();
    interval = setInterval(renderTimer, 1000);
  }

  function changeTimerLength() {
    const newMinutes = parseFloat(prompt("Enter new timer length (minutes):"));
    if (!isNaN(newMinutes) && newMinutes > 0) {
      TIMER_DURATION = newMinutes * 60000;
      localStorage.setItem(LENGTH_KEY, newMinutes);
      startTimer();
    }
  }

  editButton.addEventListener("click", changeTimerLength);
  resetButton.addEventListener("click", startTimer);

  const savedLength = parseFloat(localStorage.getItem(LENGTH_KEY));
  if (!isNaN(savedLength) && savedLength > 0) {
    TIMER_DURATION = savedLength * 60000;
  }

  if (!localStorage.getItem(STORAGE_KEY)) {
    startTimer();
  } else {
    renderTimer();
    interval = setInterval(renderTimer, 1000);
  }

  /* ---------------- WORKOUT TRACKER ---------------- */
  const container = document.getElementById("exerciseContainer");

  function createCheckboxRow() {
    const wrapper = document.createElement("div");
    wrapper.className = "checkboxes";

    const first = document.createElement("input");
    first.type = "checkbox";
    wrapper.appendChild(first);

    wrapper.addEventListener("change", () => {
      const boxes = wrapper.querySelectorAll("input[type='checkbox']");
      const last = boxes[boxes.length - 1];
      if (last.checked) {
        const newBox = document.createElement("input");
        newBox.type = "checkbox";
        wrapper.appendChild(newBox);
      }
    });

    return wrapper;
  }

  function createExerciseRow() {
    const row = document.createElement("div");
    row.className = "exercise-row";

    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "Exercise name...";

    const setsLabel = document.createElement("div");
    setsLabel.className = "sets-label";
    setsLabel.textContent = "Sets:";

    const checkboxWrapper = createCheckboxRow();

    input.addEventListener("input", () => {
      const rows = document.querySelectorAll(".exercise-row input[type='text']");
      if (input === rows[rows.length - 1] && input.value.trim() !== "") {
        createExerciseRow();
      }
    });

    row.appendChild(input);
    row.appendChild(setsLabel);
    row.appendChild(checkboxWrapper);
    container.appendChild(row);
  }

  createExerciseRow();

  document.getElementById("doneBtn").addEventListener("click", () => {
    const rows = document.querySelectorAll(".exercise-row");
    let summaryText = "";

    rows.forEach(row => {
      const input = row.querySelector("input[type='text']");
      const checkboxes = row.querySelectorAll("input[type='checkbox']");
      const name = input.value.trim();

      if (name !== "") {
        let count = 0;
        checkboxes.forEach(cb => { if (cb.checked) count++; });
        summaryText += `Exercise: ${name}\nSets: ${count}\n\n`;
      }
    });

    document.getElementById("summary").textContent = summaryText.trim();
  });

  /* ---------------- COPY POPUP ---------------- */
  document.getElementById("copyBtn").addEventListener("click", () => {
    const text = document.getElementById("summary").textContent;
    navigator.clipboard.writeText(text);

    const toast = document.getElementById("toast");
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1000);
  });
</script>

</body>
</html>
