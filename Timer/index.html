<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customizable Timer</title>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  #clock {
    text-align: center;
    padding: 16px 0;
    font-size: 2rem; /* larger clock */
    border-bottom: 1px solid #333;
    position: relative;
  }

  #edit-timer {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: white;
    font-size: 1.4rem;
    cursor: pointer;
  }

  #timer-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%; /* full width */
  }

  #timer {
    font-size: 6rem; /* bigger timer */
    width: 100%;
    text-align: center;
  }

  #reset {
    background: black;
    color: white;
    border: 1px solid white;
    padding: 16px;
    font-size: 1.2rem;
    margin: 16px;
    border-radius: 8px;
  }

  #reset:active {
    background: #222;
  }
</style>
</head>
<body>

<div id="clock">
  <span id="clock-text"></span>
  <button id="edit-timer" title="Change timer length">✏️</button>
</div>

<div id="timer-container">
  <div id="timer">2:00</div>
</div>

<button id="reset">Reset</button>

<script>
  let TIMER_DURATION = 120000; // default 2 minutes
  const STORAGE_KEY = "accurate_timer_start";
  const LENGTH_KEY = "timer_length_minutes";

  const clock = document.getElementById("clock-text");
  const timerDisplay = document.getElementById("timer");
  const resetButton = document.getElementById("reset");
  const editButton = document.getElementById("edit-timer");

  let interval;

  function updateClock() {
    const now = new Date();
    clock.textContent = now.toLocaleTimeString([], {
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    });
  }

  function getRemainingTime() {
    const startTime = parseInt(localStorage.getItem(STORAGE_KEY), 10);
    if (!startTime) return 0;

    const elapsed = Date.now() - startTime;
    return Math.max(0, TIMER_DURATION - elapsed);
  }

  function renderTimer() {
    const remainingMs = getRemainingTime();
    const totalSeconds = Math.ceil(remainingMs / 1000);

    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;

    timerDisplay.textContent =
      minutes + ":" + String(seconds).padStart(2, "0");

    if (remainingMs <= 0) {
      clearInterval(interval);
      timerDisplay.textContent = "0:00";
    }
  }

  function startTimer() {
    clearInterval(interval);
    localStorage.setItem(STORAGE_KEY, Date.now());
    renderTimer();
    interval = setInterval(renderTimer, 1000);
  }

  function changeTimerLength() {
    const newMinutes = parseInt(prompt("Enter new timer length (minutes):"), 10);
    if (!isNaN(newMinutes) && newMinutes > 0) {
      TIMER_DURATION = newMinutes * 60000;
      localStorage.setItem(LENGTH_KEY, newMinutes);
      startTimer();
    }
  }

  editButton.addEventListener("click", changeTimerLength);
  resetButton.addEventListener("click", startTimer);

  // Restore saved timer length
  const savedLength = parseInt(localStorage.getItem(LENGTH_KEY), 10);
  if (!isNaN(savedLength) && savedLength > 0) {
    TIMER_DURATION = savedLength * 60000;
  }

  // Restore timer state on reopen
  if (!localStorage.getItem(STORAGE_KEY)) {
    startTimer();
  } else {
    renderTimer();
    interval = setInterval(renderTimer, 1000);
  }

  updateClock();
  setInterval(updateClock, 1000);
</script>

</body>
</html>
